function c(i){let t=!1;try{i.addEventListener("test",function(){},{get passive(){return t=!0,!0}})}catch{}return t}function a(i,t=!1){let e=i.touches[0];return{x:t?e.pageX:e.clientX,y:t?e.pageY:e.clientY}}function d(i,t,e){for(let s=0;s<e.length;s++){let n=e[s];i[n]=t[n]}}function g(i,t,e){let s=["altKey","ctrlKey","metaKey","shiftKey"],n=["pageX","pageY","clientX","clientY","screenX","screenY","offsetX","offsetY"],o=new Event(i,{bubbles:!0,cancelable:!0}),l=t.touches[0];return o.button=0,o.which=o.buttons=1,d(o,t,s),d(o,l,n),_(o,e),o}function _(i,t){let e=t.getBoundingClientRect();i.offsetX===void 0&&(i.offsetX=i.clientX-e.x,i.offsetY=i.clientY-e.y),i.layerX===void 0&&(i.layerX=i.pageX-e.left,i.layerY=i.pageY-e.top)}function h(i,t){if(p(t),i instanceof HTMLCanvasElement){let e=t;e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0)}f(i,t,e=>e.indexOf("transition")<0),t.style.pointerEvents="none";for(let e=0;e<i.children.length;e++)h(i.children[e],t.children[e])}function f(i,t,e){let s=getComputedStyle(i);for(let n in s)(!e||e(n))&&Object.entries(t.style).forEach(([o,l])=>s[o]=l)}function p(i){["id","class","style","draggable"].forEach(function(t){i.removeAttribute(t)})}var r=class{_dropEffect;_effectAllowed;_data;_dragDropTouch;constructor(t){this._dropEffect="move",this._effectAllowed="all",this._data={},this._dragDropTouch=t}get dropEffect(){return this._dropEffect}set dropEffect(t){this._dropEffect=t}get effectAllowed(){return this._effectAllowed}set effectAllowed(t){this._effectAllowed=t}get types(){return Object.keys(this._data)}clearData(t){t!==null?delete this._data[t.toLowerCase()]:this._data={}}getData(t){let e=t.toLowerCase(),s=this._data[e];return e==="text"&&s==null&&(s=this._data["text/plain"]),s}setData(t,e){this._data[t.toLowerCase()]=e}setDragImage(t,e,s){this._dragDropTouch.setDragImage(t,e,s)}};var m={dragImageOpacity:"0.5",dragThresholdPixels:5,isPressHoldMode:!1,contextMenuDelayMS:900,pressHoldDelayMS:400,pressHoldMargin:25,pressHoldThresholdPixels:0},u=class{_dragRoot;_dropRoot;_dragSource;_lastTouch;_lastTarget;_ptDown;_isDragEnabled;_isDropZone;_dataTransfer;_img;_imgCustom;_imgOffset;_pressHoldIntervalId;configuration;constructor(t=document,e=document,s){for(this.configuration={...m,...s||{}},this._dragRoot=t,this._dropRoot=e;!this._dropRoot.elementFromPoint&&this._dropRoot.parentNode;)this._dropRoot=this._dropRoot.parentNode;this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new r(this),this._img=null,this._imgCustom=null,this._imgOffset={x:0,y:0},this.listen()}listen(){if(!navigator.maxTouchPoints)return;let t=c(this._dragRoot)?{passive:!1,capture:!1}:!1;this._dragRoot.addEventListener("touchstart",this._touchstart.bind(this),t),this._dragRoot.addEventListener("touchmove",this._touchmove.bind(this),t),this._dragRoot.addEventListener("touchend",this._touchend.bind(this)),this._dragRoot.addEventListener("touchcancel",this._touchend.bind(this))}setDragImage(t,e,s){this._imgCustom=t,this._imgOffset={x:e,y:s}}_touchstart(t){if(this._shouldHandle(t)){this._reset();let e=this._closestDraggable(t.target);e&&t.target&&!this._dispatchEvent(t,"mousemove",t.target)&&!this._dispatchEvent(t,"mousedown",t.target)&&(this._dragSource=e,this._ptDown=a(t),this._lastTouch=t,setTimeout(()=>{this._dragSource===e&&this._img===null&&this._dispatchEvent(t,"contextmenu",e)&&this._reset()},this.configuration.contextMenuDelayMS),this.configuration.isPressHoldMode&&(this._pressHoldIntervalId=setTimeout(()=>{this._isDragEnabled=!0,this._touchmove(t)},this.configuration.pressHoldDelayMS)))}}_touchmove(t){if(this._shouldCancelPressHoldMove(t)){this._reset();return}if(this._shouldHandleMove(t)||this._shouldHandlePressHoldMove(t)){let e=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",e)){this._lastTouch=t,t.preventDefault();return}if(this._dragSource&&!this._img&&this._shouldStartDragging(t)){if(this._dispatchEvent(this._lastTouch,"dragstart",this._dragSource)){this._dragSource=null;return}this._createImage(t),this._dispatchEvent(t,"dragenter",e)}this._img&&this._dragSource&&(this._lastTouch=t,t.preventDefault(),this._dispatchEvent(t,"drag",this._dragSource),e!==this._lastTarget&&(this._lastTarget&&this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",e),this._lastTarget=e),this._moveImage(t),this._isDropZone=this._dispatchEvent(t,"dragover",e))}}_touchend(t){if(this._lastTouch&&t.target&&this._lastTarget&&this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target)){t.preventDefault();return}this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target)),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}}_shouldHandle(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2}_shouldHandleMove(t){return!this.configuration.isPressHoldMode&&this._shouldHandle(t)}_shouldHandlePressHoldMove(t){return this.configuration.isPressHoldMode&&this._isDragEnabled&&t&&t.touches&&t.touches.length}_shouldCancelPressHoldMove(t){return this.configuration.isPressHoldMode&&!this._isDragEnabled&&this._getDelta(t)>this.configuration.pressHoldMargin}_shouldStartDragging(t){let e=this._getDelta(t);return e>this.configuration.dragThresholdPixels||this.configuration.isPressHoldMode&&e>=this.configuration.pressHoldThresholdPixels}_reset(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new r(this),clearInterval(this._pressHoldIntervalId)}_getDelta(t){if(!this._ptDown||this.configuration.isPressHoldMode&&!this._ptDown)return 0;let e=a(t);return Math.abs(e.x-this._ptDown.x)+Math.abs(e.y-this._ptDown.y)}_getTarget(t){let e=a(t),s=this._dropRoot.elementFromPoint(e.x,e.y);for(;s&&getComputedStyle(s).pointerEvents=="none";)s=s.parentElement;return s}_createImage(t){this._img&&this._destroyImage();let e=this._imgCustom||this._dragSource;if(this._img=e.cloneNode(!0),h(e,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){let s=e.getBoundingClientRect(),n=a(t);this._imgOffset={x:n.x-s.left,y:n.y-s.top},this._img.style.opacity=this.configuration.dragImageOpacity}this._moveImage(t),document.body.appendChild(this._img)}_destroyImage(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null}_moveImage(t){requestAnimationFrame(()=>{if(this._img){let e=a(t,!0),s=this._img.style;s.position="absolute",s.pointerEvents="none",s.zIndex="999999",s.left=Math.round(e.x-this._imgOffset.x)+"px",s.top=Math.round(e.y-this._imgOffset.y)+"px"}})}_dispatchEvent(t,e,s){if(!(t&&s))return!1;let n=g(e,t,s);return n.dataTransfer=this._dataTransfer,s.dispatchEvent(n),n.defaultPrevented}_closestDraggable(t){for(;t;t=t.parentElement)if(t.draggable)return t;return null}};function v(i=document,t=document,e){new u(i,t,e)}import.meta.url.includes("?autoload")&&v();export{v as setupDragDropTouch};
